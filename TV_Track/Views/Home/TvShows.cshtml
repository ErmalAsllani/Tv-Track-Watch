@model TV_Track.ViewModels.GeneralViewModel
@using TV_Track.Interfaces;

@inject IFilmTrackRepository filmTrackRepository 

@{

    ViewBag.homeClass = false;
    var genres = filmTrackRepository.GetGenresByMediaType("tv");
}

<section class="section section--first section--bg" data-bg="~/hotfix/img/section/section.jpg">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="section__wrap">
                    <!-- section title -->
                    <h1 class="section__title">Tv Series</h1>
                    <!-- end section title -->
                    <!-- breadcrumb -->
                    <ul class="breadcrumb">
                        <li class="breadcrumb__item"><a href="index.html">Home</a></li>
                        <li class="breadcrumb__item breadcrumb__item--active">Tv Series</li>
                    </ul>
                    <!-- end breadcrumb -->
                </div>
            </div>
        </div>
    </div>
</section>
<!-- end page title -->
<!-- filter -->
<div class="filter">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="filter__content">
                    <div class="filter__items">
                        <!-- filter item -->
                        <div class="filter__item" id="filter__genre">
                            <span class="filter__item-label">GENRE:</span>

                            <div class="filter__item-btn dropdown-toggle" role="navigation" id="filter-genre" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <input type="button" value="Action/Adventure">
                                <span></span>
                            </div>

                            <ul class="filter__item-menu dropdown-menu scrollbar-dropdown" aria-labelledby="filter-genre">
                                @foreach (var genre in genres)
                                {
                                    <li value="@genre.GenreId">@genre.GenreName</li>
                                }


                            </ul>
                        </div>                     
                    </div>

                    <form asp-controller="Home" asp-action="TvShows" method="post">
                        <input type="hidden" value="@Model.GenreID" id="genre" name="genreID" />

                        <!-- filter btn -->
                        <input class="filter__btn" type="submit" value="Filter" />
                        <!-- end filter btn -->
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end filter -->
<!-- catalog -->
<div class="catalog">
    <div class="container">
        <div class="row row--grid">
            @foreach (var tvseries in Model.Media)
            {
                <!-- card -->
                <div class="col-6 col-sm-4 col-md-3 col-xl-3">
                    <div class="card2">
                        <div class="card__cover">
                            <img src="@tvseries.Poster" alt="">
                            <a asp-controller="Home" asp-action="GetMedia" asp-route-id="@tvseries.ID" asp-route-mediaType="tv"  class="card__play">
                                <i class="icon ion-ios-play"></i>
                            </a>
                            <span class="card__rate card__rate--green">@tvseries.VoteAverage</span>
                        </div>
                        <div class="card__content">
                            <h3 class="card__title"><a href="details.html">@tvseries.Title</a></h3>
                            <span class="card__category">
                                @foreach (var genreid in tvseries.GenreIdList)
                                {
                                    <a href="#">@genres.Find(p => p.GenreId == int.Parse(genreid)).GenreName</a>
                                }
                            </span>
                        </div>
                    </div>
                </div>
                <!-- end card -->
            }

        </div>

        <div class="row">

            @if (Model.TotalPages > 1)
            {
                // This isnt a good fix so think of a better one
                <!-- paginator -->
                <div class="col-12">
                    <ul class="paginator">
                        <li class="paginator__item paginator__item--prev">
                            <a href="#"><i class="icon ion-ios-arrow-back"></i></a>
                        </li>

                        @if (Model.PageNumber < 6)
                        {

                            @for (int i = 1; i <= (Model.TotalPages <= 6 ? Model.TotalPages : 6); i++)
                            {
                                <li class="paginator__item @(i == Model.PageNumber ? "paginator__item--active" : "")"><a href="#">@i</a></li>

                            }
                        }
                        else
                        {
                            <li class="paginator__item"><a href="#">@(Model.PageNumber - 2)</a></li>
                            <li class="paginator__item"><a href="#">@(Model.PageNumber - 1)</a></li>
                            <li class="paginator__item"><a href="#">@Model.PageNumber</a></li>
                            <li class="paginator__item"><a href="#">@(Model.PageNumber + 1)</a></li>
                            <li class="paginator__item"><a href="#">@(Model.PageNumber + 2)</a></li>

                        }


                        <li class="paginator__item paginator__item--next">
                            <a href="#"><i class="icon ion-ios-arrow-forward"></i></a>
                        </li>
                    </ul>
                </div>
                <!-- end paginator -->
            }


        </div>
        <!-- end catalog -->
        <script>
    window.addEventListener('load', (event) => {

        var genreID = $("#genre").attr("value");

        $(".paginator__item a").each(function () {
            $(this).attr("href", "/Home/TvShows?genreID=" + genreID + "&pageNumber=" + $(this).text());
        });
    });
        </script>
